## 프로젝트 진행 상태 요약

**1. 전체 프로젝트 목표:**
현재 프로젝트는 C++ DirectX 12 기반의 3D 게임 엔진 개발을 목표로 합니다. 주요 기능으로는 계층적 모델 로딩, 셰이더 기반 렌더링 파이프라인, 디스크립터 테이블을 활용한 리소스 관리, 조명 시스템, UI, 충돌 감지, 그리고 최근에는 지형 위에 빌보드 객체를 배치하는 기능 등이 있습니다.

**2. 현재 작업:**
지형 위에 여러 개의 빌보드 텍스처를 배치하는 기능을 구현하고, 이 과정에서 발생한 문제들을 해결하는 작업을 진행했습니다.

**3. 주요 수정 사항:**

*   **디버깅 및 안정성 개선:**
    *   **`CScene::CreateShaderVariables` 및 `CCamera::CreateShaderVariables`의 `nullptr` 예외 해결:** 초기에는 `m_pd3dcbLights` 및 `m_pd3dcbCamera`가 `Map` 호출 시 `nullptr`이 되는 문제가 있었습니다. 이를 해결하기 위해 `stdafx.cpp`의 `CreateBufferResource` 함수에 `HRESULT` 검사 및 디버그 출력을 추가하고, `Scene.cpp` 및 `Camera.cpp`의 해당 함수에 광범위한 디버그 로깅과 `nullptr` 검사를 삽입했습니다. 문제 해결 후, 이 디버그 코드들은 제거하여 원래 상태로 되돌렸습니다.
    *   **`CShader::~CShader()` 충돌 해결:** 메인 메뉴에서 종료 시 `CShader` 소멸자에서 `delete[] m_ppd3dPipelineStates;` 부분에서 충돌이 발생했습니다. 이는 `CScene::ReleaseObjects`에서 `m_pBillboardShader`가 `m_ppShaders` 배열을 통해 한 번, 그리고 명시적으로 한 번 더 `Release()`되는 이중 해제 문제 때문이었습니다. `CScene::ReleaseObjects`에서 `m_pBillboardShader`에 대한 명시적 `Release()` 호출을 제거하여 해결했습니다.
    *   **`CTexture::~CTexture()` 충돌 해결:** 애플리케이션 종료 시 `CTexture` 소멸자에서 `delete[] m_ppd3dTextures;` 부분에서 액세스 위반이 발생했습니다. 이는 `m_pBillboardTexture`가 `CBillboardObject`의 `CMaterial`에 의해 참조 카운팅 방식으로 관리되는데, `CScene::ReleaseObjects`에서 `m_ppBillboardObjects`가 해제된 후 `m_pBillboardTexture`에 대해 다시 `Release()`를 호출하여 이중 해제가 발생했기 때문입니다. `CScene::ReleaseObjects`에서 `m_pBillboardTexture`에 대한 명시적 `Release()` 호출을 제거하여 해결했습니다.

*   **빌보드 기능 구현:**
    *   **`CBillboardObject` 클래스 생성:** `CGameObject`를 상속받아 빌보드 객체를 캡슐화하는 `CBillboardObject` 클래스(`BillboardObject.h`, `BillboardObject.cpp`)를 새로 생성했습니다. 이 클래스는 `CPointMesh`와 `CBillboardShader`를 사용하는 `CMaterial`을 관리합니다.
    *   **`Scene.h` 수정:** `BillboardObject.h`를 포함하고, `CScene` 클래스에 `m_pBillboardShader` (CBillboardShader*)와 `m_pBillboardTexture` (CTexture*) 멤버를 추가했습니다.
    *   **`CScene::BuildObjects` 수정:**
        *   `CBillboardShader`와 빌보드 텍스처(`Model/Textures/Flower01.dds` 예시)를 초기화하고 `CScene` 멤버에 할당했습니다.
        *   `CHeightMapTerrain::GetHeight` 메서드를 활용하여 지형의 높이를 쿼리하고, 플레이어의 초기 위치(`XMFLOAT3(920.0f, 745.0f, 1270.0f)`)를 기준으로 반경 200.0f 내에 100개의 빌보드 위치를 무작위로 생성했습니다.
        *   생성된 위치에 `CBillboardObject` 인스턴스를 생성하고 `m_ppBillboardObjects` 배열에 추가했습니다.
    *   **`CScene::ReleaseObjects` 수정:** `m_pBillboardShader`와 `m_pBillboardTexture`를 올바르게 해제하도록 로직을 수정했습니다. (위의 충돌 해결 과정에서 최종적으로 `m_pBillboardTexture`의 명시적 `Release()`는 제거됨)
    *   **`CBillboardObject::Render` 디버그 출력 추가:** 빌보드가 제대로 렌더링되는지 확인하기 위해 `CBillboardObject::Render` 함수에 디버그 출력을 추가했습니다.

**4. 현재 프로젝트 상태:**
*   지형 위에 빌보드 객체들이 성공적으로 렌더링되는 것을 확인했습니다.
*   빌보드들은 플레이어의 초기 생성 위치 주변에 무작위로 배치됩니다.
*   애플리케이션 종료 시 발생하던 `CShader` 및 `CTexture` 관련 액세스 위반 충돌은 이중 해제 문제를 해결함으로써 해결되었을 것으로 예상됩니다.

**5. 주요 구조 및 클래스:**
*   **`CScene`**: 게임 월드와 객체들을 관리하는 핵심 클래스. 빌보드 셰이더, 텍스처, 객체 배열을 소유.
*   **`CGameObject`**: 모든 게임 내 객체의 기본 클래스. 메시, 재질, 변환 정보를 포함.
*   **`CBillboardObject`**: `CGameObject`를 상속받아 빌보드 객체의 특정 로직(단일 점 메시, 빌보드 셰이더 사용)을 캡슐화.
*   **`CHeightMapTerrain`**: 높이 맵 데이터를 기반으로 지형을 생성하고, 특정 (x, z) 좌표에서의 높이를 제공하는 메서드(`GetHeight`)를 가짐.
*   **`CPointMesh`**: 단일 점 또는 점 목록을 표현하는 메시 클래스. 빌보드 렌더링의 입력으로 사용됨.
*   **`CBillboardShader`**: 지오메트리 셰이더를 사용하여 입력된 점을 카메라를 향하는 쿼드로 확장하여 빌보드를 렌더링하는 셰이더.
*   **`CTexture`**: 텍스처 리소스를 관리하는 클래스. 참조 카운팅을 통해 여러 객체 간 텍스처 공유를 지원.
*   **`CMaterial`**: 객체의 재질 속성(색상, 텍스처, 셰이더)을 정의하는 클래스.

**6. 다음 단계:**
현재까지의 변경 사항이 안정적으로 작동하는지 최종 확인 후, 추가적인 기능 구현(예: 빌보드 LOD, 다양한 빌보드 텍스처, 빌보드 애니메이션 등)을 고려할 수 있습니다.
